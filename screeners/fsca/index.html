
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python-based Feature Screening library">
      
      
      
        <link rel="canonical" href="https://narrowgateai.github.io/screeners/fsca/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>FSCA - narrowgate</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/material.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#narrowgate.screeners.FSCA" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="narrowgate" class="md-header__button md-logo" aria-label="narrowgate" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 21V7H5v4H3V9H1v12h2v-2h2v2h2m-4-4v-4h2v4H3m18-8v2h-2V7h-2v14h2v-2h2v2h2V9h-2m0 8h-2v-4h2v4z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            narrowgate
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FSCA
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/narrowgateai/narrowgate/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    narrowgateai/narrowgate
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="narrowgate" class="md-nav__button md-logo" aria-label="narrowgate" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 21V7H5v4H3V9H1v12h2v-2h2v2h2m-4-4v-4h2v4H3m18-8v2h-2V7h-2v14h2v-2h2v2h2V9h-2m0 8h-2v-4h2v4z"/></svg>

    </a>
    narrowgate
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/narrowgateai/narrowgate/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    narrowgateai/narrowgate
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Screeners
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Screeners" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Screeners
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Univariate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Univariate" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Univariate
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../univariate/" class="md-nav__link">
        UnivariateScreener
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Bivariate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bivariate" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Bivariate
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bivariate/" class="md-nav__link">
        BivariateScreener
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          FSCA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FSCA" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          FSCA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          FSCA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FSCA
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA" class="md-nav__link">
    FSCA
  </a>
  
    <nav class="md-nav" aria-label="FSCA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--automatic-determination-of-number-of-variables" class="md-nav__link">
    Automatic Determination of Number of Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--variable-clustering" class="md-nav__link">
    Variable Clustering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--selector-and-transformer-functionality" class="md-nav__link">
    Selector and Transformer Functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--references" class="md-nav__link">
    References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.cluster" class="md-nav__link">
    cluster()
  </a>
  
    <nav class="md-nav" aria-label="cluster()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.cluster--references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._calculate_ordered_coefficients" class="md-nav__link">
    _calculate_ordered_coefficients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._calculate_refined_coefficients" class="md-nav__link">
    _calculate_refined_coefficients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._ordered_transform" class="md-nav__link">
    _ordered_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._refined_transform" class="md-nav__link">
    _refined_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._pca_transform" class="md-nav__link">
    _pca_transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fsca_selector/" class="md-nav__link">
        FSCASelector
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fsca_transformer/" class="md-nav__link">
        FSCATransformer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          Hidden Markov Model
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hidden Markov Model" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Hidden Markov Model
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hmm_target/" class="md-nav__link">
        HMMTargetLinkScreener
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hmm_memory/" class="md-nav__link">
        HMMMemoryScreener
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          Stepwise
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Stepwise" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Stepwise
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stepwise/" class="md-nav__link">
        EnhancedStepwiseScreener
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stepwise_selector/" class="md-nav__link">
        EnhancedStepwiseSelector
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Encoders
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Encoders" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Encoders
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Nominal2Ordinal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Nominal2Ordinal" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Nominal2Ordinal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../encoders/nom_ord/" class="md-nav__link">
        Nominal2OrdinalEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/nominal2ordinal/" class="md-nav__link">
        Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Models" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          LinearRegression (Numba)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="LinearRegression (Numba)" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          LinearRegression (Numba)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/linear_regression/" class="md-nav__link">
        LinearRegression_nb
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Hidden Markov Model (Numba)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hidden Markov Model (Numba)" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Hidden Markov Model (Numba)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/hmm/" class="md-nav__link">
        HMM_nb
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Model Selection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Model Selection" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Model Selection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Walk-Backward Time Series CV
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Walk-Backward Time Series CV" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Walk-Backward Time Series CV
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model_selection/walk_backward/" class="md-nav__link">
        WalkBackwardTimeSeriesCV
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Combinatorially Purged CV
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Combinatorially Purged CV" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Combinatorially Purged CV
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model_selection/cpcv/" class="md-nav__link">
        CombinatorialPurgedCrossValidation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utilities" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/metrics_cpu/" class="md-nav__link">
        CPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/metrics_gpu/" class="md-nav__link">
        GPU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Partitioning
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Partitioning" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Partitioning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/partition_cpu/" class="md-nav__link">
        CPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/partition_gpu/" class="md-nav__link">
        GPU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Sorting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sorting" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Sorting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/sort_cpu/" class="md-nav__link">
        CPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/sort_gpu/" class="md-nav__link">
        GPU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/stats/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/test/" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/cluster/" class="md-nav__link">
        Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/pca/" class="md-nav__link">
        PCA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/numba/" class="md-nav__link">
        Numba
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA" class="md-nav__link">
    FSCA
  </a>
  
    <nav class="md-nav" aria-label="FSCA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--automatic-determination-of-number-of-variables" class="md-nav__link">
    Automatic Determination of Number of Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--variable-clustering" class="md-nav__link">
    Variable Clustering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--selector-and-transformer-functionality" class="md-nav__link">
    Selector and Transformer Functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.FSCA--references" class="md-nav__link">
    References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.transform" class="md-nav__link">
    transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.cluster" class="md-nav__link">
    cluster()
  </a>
  
    <nav class="md-nav" aria-label="cluster()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA.cluster--references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._calculate_ordered_coefficients" class="md-nav__link">
    _calculate_ordered_coefficients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._calculate_refined_coefficients" class="md-nav__link">
    _calculate_refined_coefficients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._ordered_transform" class="md-nav__link">
    _ordered_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._refined_transform" class="md-nav__link">
    _refined_transform()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narrowgate.screeners.fsca.base.FSCA._pca_transform" class="md-nav__link">
    _pca_transform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/narrowgateai/narrowgate/edit/master/docs/screeners/fsca.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>FSCA</h1>

<div class="doc doc-object doc-class">



<h2 id="narrowgate.screeners.FSCA" class="doc doc-heading">
          <code>FSCA</code>



<a href="#narrowgate.screeners.FSCA" class="headerlink" title="Permanent link">¤</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">FSCA</span><span class="p">(</span>
    <span class="n">n_components</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ordered&quot;</span><span class="p">,</span>
    <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">
        <p class="doc doc-class-bases">
          Bases: <code><span title="sklearn.base.BaseEstimator">BaseEstimator</span></code></p>


      <p>Forward Selection Component Analysis class.</p>
<p>This class attempts to solve several issues that may be encountered when 
traditional Principal Component Analysis is performed. These issues are:</p>
<ul>
<li>Required use of all variables and component interpretability when 
evaluating a high-dimensional data set</li>
<li>Excessive collinearity among variables </li>
<li>Potential lack of meaningful contribution to the data set's explainable 
variance by one or more variables.</li>
</ul>
<p>The algorithm presented in the references below (and implemented in this 
class) takes a step towards addressing the above challenges. It does so by 
intelligently selecting a subset of a user-defined number of variables 
present in the data set which represent the majority of the explained 
variance exhibited by all variables in the dataset.</p>
<p>The class offers three variable selection options available via the <code>method</code> 
parameter:</p>
<ul>
<li><strong>"pca"</strong> - no selection. All variables used.</li>
<li><strong>"ordered"</strong> - traditional forward selection method using method 
described in Puggini &amp; McLoone</li>
<li><strong>"refined"</strong> - forward selction with backward refinement as described in 
Masters</li>
</ul>
<p>It is highly recommended to use the "refined" <code>method</code> if variable selection
is desired. Refinement is implemented in a multi-threaded manner for 
significant performance improvements. </p>
<h4 id="narrowgate.screeners.FSCA--automatic-determination-of-number-of-variables">Automatic Determination of Number of Variables<a class="headerlink" href="#narrowgate.screeners.FSCA--automatic-determination-of-number-of-variables" title="Permanent link">¤</a></h4>
<p>It can often be challenging for the practitioner to know exactly how many
components to select during component analysis. Furthermore, in the case of 
FSCA, since the number of components will equal the number of variables 
selected by the algorithm, finding an ideal value is increasingly important. </p>
<p>This class offers a method proposed by Horn in 1965 that calculates 
components of random matrices which are the same shape as the dataset
being evaluated. The method then compares the average (or median)
eigenvalues from the iterations with random matrices to the eigenvalues
obtained with the actual dataset.</p>
<p>Since this method requires performing decomposition of many (potentially
large) matrices, it can be extremely time-consuming. Other methods for 
automatically detecting the optimal number of components exist and will 
look to be added as options in future development work.</p>
<p>Utilizing this method is as easy as setting <code>n_components=None</code> when 
initializing the class instance.</p>
<p>For more information on Horn's method, please consult the provided 
references.  </p>
<h4 id="narrowgate.screeners.FSCA--variable-clustering">Variable Clustering<a class="headerlink" href="#narrowgate.screeners.FSCA--variable-clustering" title="Permanent link">¤</a></h4>
<p>Finally, as an added bonus, this class provides a Hierarchical Clustering
algorithm implementation to cluster similar variables into common subspaces. 
This assists the practitioner in detecting variables which are highly 
collinear with one another. </p>
<p>This clustering method, combined with 
<a class="autorefs autorefs-internal" href="../univariate/#narrowgate.screeners.univariate.base.UnivariateScreener">UnivariateScreener</a>, is a
powerful tool to assist the practitioner in removing redundancy 
from the data set being examined while retaining those variales with the
highest informational relationship with a target variable. </p>
<p>The optimal number of clusters is automatically determined via the 
silhouette score. The support of additional clustering metrics for optimal 
cluster number determination is a work item on the roadmap.  </p>
<p>For more information on using this method, please refer to the documentation 
provided in the <code>cluster</code> method.</p>
<h4 id="narrowgate.screeners.FSCA--selector-and-transformer-functionality">Selector and Transformer Functionality<a class="headerlink" href="#narrowgate.screeners.FSCA--selector-and-transformer-functionality" title="Permanent link">¤</a></h4>
<p>Because this class has both a variable selection and variable 
transformation component to it, it serves as a base class for both a 
<code>Selector</code> class as well as a <code>Transformer</code> class that can be used with a 
scikit-learn <code>Pipeline</code>. For more information on these classes, please
refer to their documentation:</p>
<ul>
<li><a class="autorefs autorefs-internal" href="../fsca_selector/#narrowgate.screeners.FSCASelector"><code>FSCASelector</code></a></li>
<li><a class="autorefs autorefs-internal" href="../fsca_transformer/#narrowgate.screeners.FSCATransformer"><code>FSCATransformer</code></a></li>
</ul>
<p>For more information on any of the specific algorithm details implemented
within this class, please refer to the References below.</p>
<h4 id="narrowgate.screeners.FSCA--references">References<a class="headerlink" href="#narrowgate.screeners.FSCA--references" title="Permanent link">¤</a></h4>
<p>Masters, Timothy. (2019). "Extracting and Selecting Features for Data 
Mining: Algorithms in C++ and CUDA". pp. 11-51.</p>
<p>Puggini, L., McLoone, S. (2017). "Forward Selection Component 
Analysis: Algorithms and Applications". IEEE Transactions on Pattern
Analysis and Machine Intelligence, 39(12), 2395-2408. 
<a href="https://doi.org/10.1109/TPAMI.2017.2648792">https://doi.org/10.1109/TPAMI.2017.2648792</a></p>
<p>Masters, Timothy. (2016). "Data Mining Algorithms in C++". pp. 234-254.</p>
<p>Horn, J. (1965). "A rationale and test for the number of factors in factor
analysis." Psychometrika, 30(2), pp. 179-185.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n_components</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
          </td>
          <td><p>Number of principal components to use.<br />
This number also equates to the number of variables that will be 
'selected' from the dataset.<br />
If <code>None</code>, then Horn's method will be used to automatically
determine the number of components to use and variables to select.<br />
<strong>Note:</strong><br />
Horn's method will substantially increase the runtime of <code>fit</code>
method as it is dependent on the number of observations present in 
the dataset.</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
          </td>
          <td><p>Valid options: {"pca", "ordered", "refined"}<br />
Method to use in the variable selection process</p>
<ul>
<li><strong>"pca"</strong> - no selection. All variables used.</li>
<li><strong>"ordered"</strong> - traditional forward selection method using method 
described in Puggini &amp; McLoone</li>
<li><strong>"refined"</strong> - forward selction with backward refinement as 
described in Masters reference (2019)</li>
</ul></td>
          <td>
                <code>&#39;ordered&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>dropna</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
          </td>
          <td><p>flag for indicating whether NaN values will be removed from 
consideration during standardization and component execution.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>standardize</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
          </td>
          <td><p>flag for indicating whether data should be mean-centered and scaled
to unit variance prior to fitting the components.<br />
This should almosts always be set to <code>True</code>.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n_components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ordered&quot;</span><span class="p">,</span>
    <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">standardize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_components :</span>
<span class="sd">        Number of principal components to use.  </span>
<span class="sd">        This number also equates to the number of variables that will be </span>
<span class="sd">        &#39;selected&#39; from the dataset.  </span>
<span class="sd">        If `None`, then Horn&#39;s method will be used to automatically</span>
<span class="sd">        determine the number of components to use and variables to select.  </span>
<span class="sd">        **Note:**  </span>
<span class="sd">        Horn&#39;s method will substantially increase the runtime of `fit`</span>
<span class="sd">        method as it is dependent on the number of observations present in </span>
<span class="sd">        the dataset. </span>
<span class="sd">    method :</span>
<span class="sd">        Valid options: {&quot;pca&quot;, &quot;ordered&quot;, &quot;refined&quot;}  </span>
<span class="sd">        Method to use in the variable selection process</span>

<span class="sd">        * **&quot;pca&quot;** - no selection. All variables used.</span>
<span class="sd">        * **&quot;ordered&quot;** - traditional forward selection method using method </span>
<span class="sd">        described in Puggini &amp; McLoone</span>
<span class="sd">        * **&quot;refined&quot;** - forward selction with backward refinement as </span>
<span class="sd">        described in Masters reference (2019)</span>
<span class="sd">    dropna :</span>
<span class="sd">        flag for indicating whether NaN values will be removed from </span>
<span class="sd">        consideration during standardization and component execution.</span>
<span class="sd">    standardize :</span>
<span class="sd">        flag for indicating whether data should be mean-centered and scaled</span>
<span class="sd">        to unit variance prior to fitting the components.  </span>
<span class="sd">        This should almosts always be set to `True`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span><span class="s1">&#39;ordered&#39;</span><span class="p">,</span> <span class="s1">&#39;refined&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;method&#39; parameter must be one of the following: &quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&#39;pca&#39;, &#39;ordered&#39;, or &#39;refined&#39;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_components</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">n_components</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span>
    <span class="k">elif</span> <span class="n">n_components</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;n_components&#39; parameter must be an integer value greater &quot;</span> <span class="o">+</span>
            <span class="s2">&quot;than 1 or &#39;None&#39; in order to use Horn&#39;s method to &quot;</span> <span class="o">+</span>
            <span class="s2">&quot;automatically determine the number of components/variables &quot;</span> <span class="o">+</span> 
            <span class="s2">&quot;to select!&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span> <span class="o">=</span> <span class="n">dropna</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span> <span class="o">=</span> <span class="n">standardize</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
</td></tr></table>
            </details>



  <div class="doc doc-children">

















  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA.fit" class="doc doc-heading">
fit


<a href="#narrowgate.screeners.fsca.base.FSCA.fit" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Fits an FSCA object based on a pandas DataFrame <code>X</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pandas" href="http://pandas.pydata.org/pandas-docs/stable/index.html#module-pandas">pd</a>.<a class="autorefs autorefs-external" title="pandas.DataFrame" href="http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame">DataFrame</a></code>
          </td>
          <td><p>pandas DataFrame of exogenous variables</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>None</code>
          </td>
          <td><p>always <strong>None</strong><br />
Must be present due to scikit-learn's BaseEstimator which is needed
for <code>Mixin</code>capability. However, is not needed for functionality 
within the class itself.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
          </td>
          <td><p>boolean to indicate whether method progress updates should
be reported to the user via the console.<br />
Formal logging may be a preferred option as a future improvement.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
    <span class="n">y</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits an FSCA object based on a pandas DataFrame `X`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X</span>
<span class="sd">        pandas DataFrame of exogenous variables</span>
<span class="sd">    y</span>
<span class="sd">        always **None**  </span>
<span class="sd">        Must be present due to scikit-learn&#39;s BaseEstimator which is needed</span>
<span class="sd">        for `Mixin`capability. However, is not needed for functionality </span>
<span class="sd">        within the class itself.</span>
<span class="sd">    verbose</span>
<span class="sd">        boolean to indicate whether method progress updates should</span>
<span class="sd">        be reported to the user via the console.  </span>
<span class="sd">        Formal logging may be a preferred option as a future improvement. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="c1"># Prior to performing any work, do a quick search for any variables</span>
    <span class="c1"># being passed in that have exactly zero variab</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feature_names_in_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_feature_names_in_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">zero_var_mask</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">zero_var_mask</span><span class="p">):</span>
        <span class="n">zero_var_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero_var_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zero_var_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">zero_var_idx</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">zero_var_names</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ALERT! The following columns have zero variance and must &#39;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;be dropped for algorithm stability: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zero_var_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">npred</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Find mean and stdev of the data.</span>
    <span class="c1"># If there are a different number of NA&#39;s in each column</span>
    <span class="c1"># of the data, then the covariance matrix will not have</span>
    <span class="c1"># a diagonal of 1.0. In order to account for this, then</span>
    <span class="c1"># only the rows that are entirely non-NA need to be used</span>
    <span class="c1"># to calculate the mean and std for each variable.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">X_work</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">X_work</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">:</span>
        <span class="n">X_work</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_work</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Original paper only centers (zero-mean) (p.16).</span>
    <span class="c1"># Masters standardizes and therefore the covariance</span>
    <span class="c1"># matrix is actually the correlation matrix with diagonal</span>
    <span class="c1"># values of 1.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">covar</span> <span class="o">=</span> <span class="n">X_work</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>

    <span class="c1">########################################</span>
    <span class="c1">## mean squared correlation DataFrame ##</span>
    <span class="c1">########################################</span>
    <span class="n">kept_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">crit_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npred</span><span class="p">):</span>
        <span class="n">crit</span> <span class="o">=</span> \
            <span class="n">newvar_crit_nb</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">kept_columns</span><span class="p">,</span>
                <span class="n">trial_col</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># &#39;crit&#39; includes correlation with itself ... remove it</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="p">(</span><span class="n">crit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npred</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">crit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crit</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corr</span> <span class="o">=</span> \
        <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">crit_list</span><span class="p">,</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mean_sq_corr&#39;</span><span class="p">)</span>

    <span class="c1">#####################################################</span>
    <span class="c1">## Compute eigenstructure of the covariance matrix ##</span>
    <span class="c1">#####################################################</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">)</span>

    <span class="c1"># numpy doesn&#39;t guarantee ordered eigenvalues.</span>
    <span class="c1"># order them from greatest to least along with their respective</span>
    <span class="c1"># eigenvectors</span>
    <span class="n">eig_sort_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[</span><span class="n">eig_sort_idx</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span><span class="p">[:,</span><span class="n">eig_sort_idx</span><span class="p">]</span>

    <span class="c1"># Account for any negative eigenvalues</span>
    <span class="n">neg_eigval_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[</span><span class="n">neg_eigval_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Set 1.e-9 as an arbitrary value to determine the number</span>
    <span class="c1"># of unique eigenvectors available during &#39;transform&#39;.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_eigval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span> <span class="o">&gt;</span> <span class="mf">1.e-9</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigval_cum</span> <span class="o">=</span> \
        <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">)</span>

    <span class="c1">########################################################</span>
    <span class="c1">## Compute the eigvalues using Horn&#39;s method          ##</span>
    <span class="c1">## - This helps determine the optimal number of       ##</span>
    <span class="c1">##   components to retain                             ##</span>
    <span class="c1">########################################################</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating Horn&#39;s eigenvalue matrix ... &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of observations: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of variables: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">npred</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Determine the number of iterations to use for Horn&#39;s method.</span>
        <span class="c1"># If there are an extreme number of variables being evaluated in the</span>
        <span class="c1"># original data set, it is worthwhile to consider dropping the number</span>
        <span class="c1"># of random iterations performed. Doing so will make the value to</span>
        <span class="c1"># determine the number of components to choose less stable, but will</span>
        <span class="c1"># speed up the &#39;fit&#39; considerably.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npred</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
            <span class="n">n_iters</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_iters</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Monte Carlo reps: </span><span class="si">{</span><span class="n">n_iters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horns_eigenvalue_matrix</span> <span class="o">=</span> \
            <span class="n">horns_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npred</span><span class="p">,</span> <span class="n">n_iters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_eigvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">horns_eigval_median</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horns_eigenvalue_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">n_comp_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_eigvals</span> <span class="o">&gt;=</span> <span class="n">horns_eigval_median</span>
        <span class="n">n_horns_comps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting number of components to </span><span class="si">{</span><span class="n">n_horns_comps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_horns_comps</span>

    <span class="c1">############################################################</span>
    <span class="c1">## Eigenvector and Principal Component Factors DataFrames ##</span>
    <span class="c1">############################################################</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X_work</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span> <span class="o">=</span> \
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span><span class="p">,</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc_factors</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_unique_eigval</span><span class="p">],</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_unique_eigval</span><span class="p">]))</span>

    <span class="c1">####################################################</span>
    <span class="c1"># If method == &#39;pca&#39;, then calculations stop here. #</span>
    <span class="c1">####################################################</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ordered&#39;</span><span class="p">,</span><span class="s1">&#39;refined&#39;</span><span class="p">]:</span>

        <span class="c1"># first variable selected = greatest corr. to other variables.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="o">.</span><span class="n">values</span><span class="p">)])</span>

        <span class="c1"># Move on to the stepwise component selection</span>
        <span class="c1"># The best (max multiple-R) column is in best_column, so start with it.</span>

        <span class="c1"># If the correlation matrix is singular (one or more zero eigenvalues)</span>
        <span class="c1"># then reduce the correlations enough to make it nonsingular.</span>
        <span class="c1"># This is crucial, because some of the tests that we now use</span>
        <span class="c1"># involve inverting Z&#39;Z, so it must be nonsingular.</span>

        <span class="c1"># Should require just one pass to eliminate singularity</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NOTE: Adjusting correlations because some variables are collinear&quot;</span><span class="p">)</span>

            <span class="c1"># perturb the non-diagonal values</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npred</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.99999</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="p">)</span>

            <span class="c1"># numpy doesn&#39;t guarantee ordered eigenvalues.</span>
            <span class="c1"># order them along with their respective eigenvectors</span>
            <span class="n">eig_sort_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">[</span><span class="n">eig_sort_idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span><span class="p">[:,</span><span class="n">eig_sort_idx</span><span class="p">]</span>

        <span class="c1"># Count the kept variables.</span>
        <span class="c1"># This value will eventually equal &#39;n_components&#39; when complete</span>
        <span class="c1"># except in pathological cases</span>
        <span class="n">nkept</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">best_crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.e50</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Commencing stepwise construction with &quot;</span> <span class="o">+</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># While we still need to keep more components</span>
        <span class="k">while</span> <span class="n">nkept</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">:</span>
            <span class="c1"># Will flag if we got a good new column</span>
            <span class="n">best_column</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c1"># Try all columns (predictors)</span>
            <span class="k">for</span> <span class="n">icol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npred</span><span class="p">):</span>
                <span class="c1"># If the column has already been selected, skip it</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">icol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">:</span>
                    <span class="n">crit</span> <span class="o">=</span> \
                        <span class="n">newvar_crit_nb</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">,</span>
                            <span class="n">trial_col</span><span class="o">=</span><span class="n">icol</span><span class="p">)</span>

                    <span class="c1"># Debug print</span>
                    <span class="c1">#print(f&quot;    Trial: {data.columns[icol]} = {crit}&quot;)</span>

                    <span class="k">if</span> <span class="n">crit</span> <span class="o">&gt;</span> <span class="n">best_crit</span><span class="p">:</span>
                        <span class="n">best_crit</span> <span class="o">=</span> <span class="n">crit</span>
                        <span class="n">best_column</span> <span class="o">=</span> <span class="n">icol</span>

            <span class="c1"># Check if a best_column was found</span>
            <span class="k">if</span> <span class="n">best_column</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Then must be done adding columns.</span>
                <span class="c1"># Getting here would be pathological.</span>
                <span class="c1"># Adding a column should ALWAYS improve the criterion</span>
                <span class="c1"># Unless there is some perfect collinearity, but</span>
                <span class="c1"># that was eliminated earlier</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING... Adding a new column failed to improve &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;the criterion!&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - Added </span><span class="si">{</span><span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">best_column</span><span class="p">]</span><span class="si">}</span><span class="s2"> for &quot;</span> <span class="o">+</span>
                    <span class="sa">f</span><span class="s2">&quot;criterion=</span><span class="si">{</span><span class="n">best_crit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">,</span> <span class="n">best_column</span><span class="p">)</span>
            <span class="n">nkept</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;refined&#39;</span><span class="p">:</span>
                <span class="n">best_crit</span><span class="p">,</span> <span class="n">crit_matrix</span> <span class="o">=</span> \
                    <span class="n">spbr_nb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covar</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">)</span>
                <span class="n">max_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">crit_matrix</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">max_crit</span> <span class="o">&gt;</span> <span class="n">best_crit</span><span class="p">:</span>
                    <span class="n">refined_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">crit_matrix</span> <span class="o">==</span> <span class="n">max_crit</span><span class="p">)</span>
                    <span class="n">old_col_idx</span> <span class="o">=</span> <span class="n">refined_idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">new_col_idx</span> <span class="o">=</span> <span class="n">refined_idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">old_col_name</span> <span class="o">=</span> \
                        <span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">[</span><span class="n">old_col_idx</span><span class="p">]]</span>
                    <span class="n">new_col_name</span> <span class="o">=</span> <span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">new_col_idx</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Replaced </span><span class="si">{</span><span class="n">old_col_name</span><span class="si">}</span><span class="s2"> with &quot;</span> <span class="o">+</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_col_name</span><span class="si">}</span><span class="s2"> to get criterion = </span><span class="si">{</span><span class="n">max_crit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">[</span><span class="n">old_col_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_col_idx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - no refinement needed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span> <span class="o">=</span> \
            <span class="n">X_work</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_columns</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ordered&#39;</span><span class="p">:</span>
            <span class="c1"># The values stored in &#39;B&#39; are the coefficients of the &#39;kept_columns&#39;</span>
            <span class="c1"># that can be used to produce out-of-sample components based on the</span>
            <span class="c1"># &#39;ordered&#39; FSCA process.</span>

            <span class="c1"># These components are approximately orthogonal.</span>
            <span class="c1"># They are listed in decreasing order of variance capture by the variables</span>
            <span class="c1"># The order of the variables is independent of the user&#39;s choice in the</span>
            <span class="c1"># number of variables to compute although the coefficients may vary somewhat</span>
            <span class="c1"># according to the number of components.</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_ordered_coefficients</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

            <span class="c1"># Create a DataFrame linking the coefficents in B to the kept columns</span>
            <span class="c1"># as well as the components</span>
            <span class="n">comp_col_names</span> <span class="o">=</span> \
                <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;FSCA_ORD_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">))]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> \
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">B</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">comp_col_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">##############################</span>
            <span class="c1">## self.method == &#39;refined&#39; ##</span>
            <span class="c1">##############################</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_refined_coefficients</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA.transform" class="doc doc-heading">
transform


<a href="#narrowgate.screeners.fsca.base.FSCA.transform" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Transforms pandas DataFrame, <code>X</code>, by returning  the components 
calculated during <code>fit</code> method execution.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pd.DataFrame </code>
          </td>
          <td><p>pandas DataFrame of FSCA components</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pandas" href="http://pandas.pydata.org/pandas-docs/stable/index.html#module-pandas">pd</a>.<a class="autorefs autorefs-external" title="pandas.DataFrame" href="http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame">DataFrame</a></code>
          </td>
          <td><p>pandas DataFrame to transform</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms pandas DataFrame, `X`, by returning  the components </span>
<span class="sd">    calculated during `fit` method execution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame :</span>
<span class="sd">        pandas DataFrame of FSCA components</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X :</span>
<span class="sd">        pandas DataFrame to transform</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># confirm number of columns are the same as what was &#39;fit&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;pca&#39;</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pca_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ordered&#39;</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># self.method = &#39;refined&#39;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refined_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA.cluster" class="doc doc-heading">
cluster


<a href="#narrowgate.screeners.fsca.base.FSCA.cluster" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">cluster</span><span class="p">(</span>
    <span class="n">cluster_type</span><span class="o">=</span><span class="s2">&quot;centroid&quot;</span><span class="p">,</span>
    <span class="n">min_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;silhouette&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Method for clustering variables into similar subspaces.</p>
<p>Utilizes principal components, hierarchical clustering, and a 
clustering metric in order to determine optimal number of 
clusters/subspacess in the data set.</p>
<p>Requires that <code>fit</code> method be called prior to execution as a dependency 
exists on the instance member <code>pc_factors</code>. </p>
<p>Utilizes <code>n_components</code> when determining the clusters.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cluster_type</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
          </td>
          <td><p>string indicating the clustering type to use.
Options:<br />
<strong>"centroid"</strong> - recalculates component centroids for cluster as 
each new variable is added to cluster (preferred).
<strong>"other"</strong> - uses component values of dominant variable in cluster
as centroid. In other words, the component values of the first 
variable selected into the cluster determine the cluster centroid
for the cluster even as new variables are added to the cluster.</p></td>
          <td>
                <code>&#39;centroid&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>min_clusters</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
          </td>
          <td><p>minimum number of clusters to consider when determining the optimal 
number of clusters</p></td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>max_clusters</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
          </td>
          <td><p>maximum number of clusters to consider when determining the optimal 
number of clusters. This number should be less than the number of
components present in <code>pc_factors</code> and greater than <code>min_clusters</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
          </td>
          <td><p>cluster metric to use when determining the optimal number of 
clusters. Options include:<br />
<strong>"silhouette"</strong></p></td>
          <td>
                <code>&#39;silhouette&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
          </td>
          <td><p>boolean flag for indicating whether progress updates on method 
execution should be reported to the user via the console.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>clusters</code></td>
          <td>
                <code>pd.Series</code>
          </td>
          <td><p>pandas Series that contains the name of the variable as the index
and the cluster number for that variable as the value.</p></td>
        </tr>
    </tbody>
  </table>
      <h5 id="narrowgate.screeners.fsca.base.FSCA.cluster--references">References<a class="headerlink" href="#narrowgate.screeners.fsca.base.FSCA.cluster--references" title="Permanent link">¤</a></h5>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cluster_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;centroid&#39;</span><span class="p">,</span>
    <span class="n">min_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">max_clusters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;silhouette&#39;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for clustering variables into similar subspaces.</span>

<span class="sd">    Utilizes principal components, hierarchical clustering, and a </span>
<span class="sd">    clustering metric in order to determine optimal number of </span>
<span class="sd">    clusters/subspacess in the data set.</span>

<span class="sd">    Requires that `fit` method be called prior to execution as a dependency </span>
<span class="sd">    exists on the instance member `pc_factors`. </span>

<span class="sd">    Utilizes `n_components` when determining the clusters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cluster_type :</span>
<span class="sd">        string indicating the clustering type to use.</span>
<span class="sd">        Options:  </span>
<span class="sd">        **&quot;centroid&quot;** - recalculates component centroids for cluster as </span>
<span class="sd">        each new variable is added to cluster (preferred).</span>
<span class="sd">        **&quot;other&quot;** - uses component values of dominant variable in cluster</span>
<span class="sd">        as centroid. In other words, the component values of the first </span>
<span class="sd">        variable selected into the cluster determine the cluster centroid</span>
<span class="sd">        for the cluster even as new variables are added to the cluster.</span>
<span class="sd">    min_clusters :</span>
<span class="sd">        minimum number of clusters to consider when determining the optimal </span>
<span class="sd">        number of clusters</span>
<span class="sd">    max_clusters :</span>
<span class="sd">        maximum number of clusters to consider when determining the optimal </span>
<span class="sd">        number of clusters. This number should be less than the number of</span>
<span class="sd">        components present in `pc_factors` and greater than `min_clusters`</span>
<span class="sd">    metric :</span>
<span class="sd">        cluster metric to use when determining the optimal number of </span>
<span class="sd">        clusters. Options include:  </span>
<span class="sd">        **&quot;silhouette&quot;**</span>
<span class="sd">    verbose :</span>
<span class="sd">        boolean flag for indicating whether progress updates on method </span>
<span class="sd">        execution should be reported to the user via the console.</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    clusters : pd.Series</span>
<span class="sd">        pandas Series that contains the name of the variable as the index</span>
<span class="sd">        and the cluster number for that variable as the value.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">._cluster</span> <span class="kn">import</span> <span class="n">cluster_variables</span>
    <span class="kn">from</span> <span class="nn">...utils.cluster</span> <span class="kn">import</span> <span class="n">silhouette_nb</span><span class="p">,</span> <span class="n">find_optimal_cluster</span>
    <span class="kn">from</span> <span class="nn">statistics</span> <span class="kn">import</span> <span class="n">mode</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_clusters</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pc_factors&#39;</span><span class="p">)</span>

    <span class="c1"># If max_clusters is None, then set to the number of components</span>
    <span class="n">n_pc_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_factors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_clusters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_clusters</span> <span class="o">=</span> <span class="n">n_pc_factors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_clusters</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">max_clusters</span> <span class="o">&gt;</span> <span class="n">min_clusters</span>
        <span class="k">assert</span> <span class="n">max_clusters</span> <span class="o">&lt;=</span> <span class="n">n_pc_factors</span> 

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing hierarchical clustering ...&quot;</span><span class="p">)</span>
    <span class="n">cluster_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cluster_variables</span><span class="p">(</span><span class="n">cluster_type</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating clustering performance ...&quot;</span><span class="p">)</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_factors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">]</span>
    <span class="n">sil_list</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">result_iter</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">cluster_results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_clusters</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">max_clusters</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">silhouette</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">cluster_dist</span> <span class="o">=</span> \
                    <span class="n">silhouette_nb</span><span class="p">(</span>
                        <span class="n">factors</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">result_iter</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">],</span>
                        <span class="n">result_iter</span><span class="p">[</span><span class="s1">&#39;n_in_group&#39;</span><span class="p">],</span>
                        <span class="n">result_iter</span><span class="p">[</span><span class="s1">&#39;centroids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">sil_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">silhouette</span><span class="p">)</span>
                <span class="n">sil_list</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sil_mean</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_clusters</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selecting optimal cluster ...&quot;</span><span class="p">)</span>
    <span class="n">sil_cluster_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sil_list</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">best_iter_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
        <span class="n">best_iter</span><span class="p">,</span> <span class="n">best_score</span> <span class="o">=</span> \
            <span class="n">find_optimal_cluster</span><span class="p">(</span>
                <span class="n">sil_cluster_values</span><span class="p">,</span>
                <span class="n">max_since_best_iter</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">best_iter_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_iter</span><span class="p">)</span>

    <span class="n">n_clusters_optimal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">(</span><span class="n">best_iter_list</span><span class="p">))</span>
    <span class="n">optimal_cluster_membership</span> <span class="o">=</span> \
        <span class="n">cluster_results</span><span class="p">[</span><span class="n">n_clusters_optimal</span><span class="p">][</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> \
        <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">optimal_cluster_membership</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_factors</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complete.&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA._calculate_ordered_coefficients" class="doc doc-heading">
_calculate_ordered_coefficients


<a href="#narrowgate.screeners.fsca.base.FSCA._calculate_ordered_coefficients" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">_calculate_ordered_coefficients</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Class method called when <code>method='ordered'</code></p>
<p>Computes components of input data, <code>X</code> with no backward refinement.</p>
<p>The columns used in creating the components are strictly ordered by 
variable.</p>
<p>Variables ara added in order of increasing ability to reconstruct the 
dataset, and no variable replacement is performed. The implication is 
that the components are independent of the number of components 
requested by the user.</p>
<p>Also, the first component will be the first variable selected (that 
having maximum mean squared correlation).  The second component will be 
the second variable with the projection of the first variable removed.</p>
<p>In general, each component will be that variable (in the order selected) 
with the contributions of all prior variables removed via a Gram-Schmidt 
orthogonalization process.</p>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_calculate_ordered_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class method called when `method=&#39;ordered&#39;`</span>

<span class="sd">    Computes components of input data, `X` with no backward refinement.</span>

<span class="sd">    The columns used in creating the components are strictly ordered by </span>
<span class="sd">    variable.</span>

<span class="sd">    Variables ara added in order of increasing ability to reconstruct the </span>
<span class="sd">    dataset, and no variable replacement is performed. The implication is </span>
<span class="sd">    that the components are independent of the number of components </span>
<span class="sd">    requested by the user.</span>

<span class="sd">    Also, the first component will be the first variable selected (that </span>
<span class="sd">    having maximum mean squared correlation).  The second component will be </span>
<span class="sd">    the second variable with the projection of the first variable removed.</span>

<span class="sd">    In general, each component will be that variable (in the order selected) </span>
<span class="sd">    with the contributions of all prior variables removed via a Gram-Schmidt </span>
<span class="sd">    orthogonalization process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># confirm that &#39;kept_column_names&#39; are present in &#39;data&#39;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">])</span>

    <span class="n">n_cases</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># At this point, the best subset of nkept = n_components predictors</span>
    <span class="c1"># have been found.</span>
    <span class="c1"># Regardless of whether method = &#39;ordered&#39; or &#39;refined&#39;,</span>
    <span class="c1"># we will need the outer product Z&#39;Z in covar.</span>
    <span class="c1"># Compute it now.</span>
    <span class="n">covar</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>

    <span class="c1"># original code has n_cases populating the diagonal for the ordered</span>
    <span class="c1"># coefficients calculation. The &#39;refined&#39; calculation uses the</span>
    <span class="c1"># covariance matrix as-is.</span>
    <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">covar</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">n_cases</span><span class="p">)</span>

    <span class="c1"># Compute and save the components for the entire dataset.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">gram_schmidt_nb</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># GramSchmidt leaves the columns unit length</span>
    <span class="c1"># we want their sum of squares to be n_cases so that they have</span>
    <span class="c1"># unit standard deviation.</span>
    <span class="n">output</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_cases</span><span class="p">)</span>

    <span class="c1"># &#39;output&#39; contains the orthogonalized kept variables.</span>

    <span class="c1"># We could just use these as the created variables, but that would make</span>
    <span class="c1"># it impossible to create corresponding OOS variables.</span>
    <span class="c1"># Plus, many users want to see how to compute the components from the</span>
    <span class="c1"># selected variables.  So we use simple linear regression to find the</span>
    <span class="c1"># coefficients.</span>

    <span class="c1"># Rather than using a sophisticated method, which would be overkill, we</span>
    <span class="c1"># just use the simple matrix inversion method.</span>

    <span class="c1"># In keeping with the notation in the paper, we define:</span>
    <span class="c1">#  Z - n_cases by nkept matrix of variables selected above</span>
    <span class="c1">#  M - n_cases by nkept matrix of computed components</span>

    <span class="c1"># We now wish to find the weight matrix B that will let us compute</span>
    <span class="c1"># M from Z by a simple linear transformation:</span>
    <span class="c1">#   M = Z B</span>
    <span class="c1"># The well-known least-squares solution to this problem is:</span>
    <span class="c1">#         -1</span>
    <span class="c1"># B = (Z&#39;Z)   Z&#39; M</span>

    <span class="c1"># Because the Gram-Schmidt process is a linear transformation,</span>
    <span class="c1"># these predicted values will also be orthogonal (except for minor fpt</span>
    <span class="c1"># error).</span>

    <span class="c1"># Invert Z&#39;Z (in covar).  It should always be invertible (nonsingular)</span>
    <span class="c1"># because a long time ago we computed n_unique, the rank of the</span>
    <span class="c1"># full data matrix, and reduced n_components to that value if needed.</span>
    <span class="c1"># Then, when the n_components subset of variables was selected, the</span>
    <span class="c1"># algorithm by design favored selecting variables most independent</span>
    <span class="c1"># of those already selected.</span>
    <span class="n">work_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>

    <span class="c1"># We now have the inverse of Z&#39;Z in &#39;work_inv&#39;</span>
    <span class="c1"># Compute Z&#39;M</span>
    <span class="n">Z_prime_M</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">output</span><span class="p">)</span>

    <span class="c1"># Last step: Multiply those two matrices to get B, the coefficients.</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">work_inv</span><span class="p">,</span> <span class="n">Z_prime_M</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">B</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA._calculate_refined_coefficients" class="doc doc-heading">
_calculate_refined_coefficients


<a href="#narrowgate.screeners.fsca.base.FSCA._calculate_refined_coefficients" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">_calculate_refined_coefficients</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Class method called when <code>method='refined'</code></p>
<p>The order of variable selection is changed by refinement in which case
the principal components of the selected variables are calculated.</p>
<p>This method produces additional 'refined' members of the class that
correspond to the:
- eigenvalues
- eigenvectors
- cumulative explained variance of each component
- correlations of selected variables to each component</p>
<p>In addition, the weights of variables for each component are calculated
according to the recommendation on page 51 of the reference text by 
Masters.</p>
<p>The class member <code>component_correlations_refined</code> is a pandas DataFrame
whose values correspond to the correlations and the component 
represented in the given column</p>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_calculate_refined_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class method called when `method=&#39;refined&#39;`</span>

<span class="sd">    The order of variable selection is changed by refinement in which case</span>
<span class="sd">    the principal components of the selected variables are calculated.</span>

<span class="sd">    This method produces additional &#39;refined&#39; members of the class that</span>
<span class="sd">    correspond to the:</span>
<span class="sd">    - eigenvalues</span>
<span class="sd">    - eigenvectors</span>
<span class="sd">    - cumulative explained variance of each component</span>
<span class="sd">    - correlations of selected variables to each component</span>

<span class="sd">    In addition, the weights of variables for each component are calculated</span>
<span class="sd">    according to the recommendation on page 51 of the reference text by </span>
<span class="sd">    Masters.</span>

<span class="sd">    The class member `component_correlations_refined` is a pandas DataFrame</span>
<span class="sd">    whose values correspond to the correlations and the component </span>
<span class="sd">    represented in the given column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># confirm that &#39;kept_column_names&#39; are present in &#39;data&#39;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">])</span>

    <span class="c1"># Compute the outer product Z&#39;Z in covar.</span>
    <span class="n">covar</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>

    <span class="c1"># Compute the eigenstructure of the correlation matrix of selected columns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">covar</span><span class="p">)</span>

    <span class="c1"># numpy doesn&#39;t guarantee ordered eigenvalues.</span>
    <span class="c1"># order them along with their respective eigenvectors</span>
    <span class="n">eig_sort_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sort_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">[</span><span class="n">eig_sort_idx</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span><span class="p">[:,</span><span class="n">eig_sort_idx</span><span class="p">]</span>

    <span class="c1"># Account for any negative eigenvalues</span>
    <span class="n">neg_eigval_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">[</span><span class="n">neg_eigval_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Use self.n_unique_eigval which was calculated earlier in &#39;fit&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eigval_cum_refined</span> <span class="o">=</span> \
        <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n_unique_eigval</span>

    <span class="c1">############################################################</span>
    <span class="c1">## Eigenvector and Principal Component Factor DataFrames ##</span>
    <span class="c1">############################################################</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">n_comps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;FSCA_REF_PC</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_comps</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span> <span class="o">=</span> \
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span><span class="p">,</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">,</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_correlations_refined</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eigvecs_refined</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span><span class="p">))</span>
        <span class="c1"># Calculate the weights for computing the component standardized to</span>
        <span class="c1"># unit variance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">component_correlations_refined</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eigvals_refined</span> <span class="o">+</span> <span class="mf">1.e-60</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA._ordered_transform" class="doc doc-heading">
_ordered_transform


<a href="#narrowgate.screeners.fsca.base.FSCA._ordered_transform" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">_ordered_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Out-of-sample transformation of data when <code>method='ordered'</code></p>
<p>Based on 'B' matrix</p>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_ordered_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Out-of-sample transformation of data when `method=&#39;ordered&#39;`</span>

<span class="sd">    Based on &#39;B&#39; matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># confirm that &#39;kept_column_names&#39; are present in &#39;data&#39;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">])</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span>

    <span class="n">components</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">components</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA._refined_transform" class="doc doc-heading">
_refined_transform


<a href="#narrowgate.screeners.fsca.base.FSCA._refined_transform" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">_refined_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Out-of-sample transformation of data when <code>method='refined'</code></p>
<p>Based on Principal Component Factors</p>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_refined_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Out-of-sample transformation of data when `method=&#39;refined&#39;`</span>

<span class="sd">    Based on Principal Component Factors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># confirm that &#39;kept_column_names&#39; are present in &#39;data&#39;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">])</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kept_column_names</span><span class="p">]</span>

    <span class="n">components</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">components</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="narrowgate.screeners.fsca.base.FSCA._pca_transform" class="doc doc-heading">
_pca_transform


<a href="#narrowgate.screeners.fsca.base.FSCA._pca_transform" class="headerlink" title="Permanent link">¤</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">_pca_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Out-of-sample transformation of data when <code>method='pca'</code></p>
<p>Based on standard Principal Component Analysis</p>

        <details class="quote">
          <summary>Source code in <code>narrowgate/screeners/fsca/base.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_pca_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Out-of-sample transformation of data when `method=&#39;pca&#39;`</span>

<span class="sd">    Based on standard Principal Component Analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Center and/or standardize according to what was done in fit</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>

    <span class="c1"># Calculate the principal components for each observation</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvecs</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigvals</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">components</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../bivariate/" class="md-footer__link md-footer__link--prev" aria-label="Previous: BivariateScreener" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              BivariateScreener
            </div>
          </div>
        </a>
      
      
        
        <a href="../fsca_selector/" class="md-footer__link md-footer__link--next" aria-label="Next: FSCASelector" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              FSCASelector
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>